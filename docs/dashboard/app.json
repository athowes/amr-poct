[{"name":"app.R","content":"library(shiny)\n\nrun_cea <- function(sensitivity, specificity, amr_burden_per_abx = NULL) {\n  births_per_year <- 25 * 10^6\n  sepsis_rate <- 70 / 1000\n  births_sepsis <- births_per_year * sepsis_rate\n  prop_high_risk_sepsis <- 0.4\n  prop_low_risk_sepsis <- 1 - prop_high_risk_sepsis\n  births_sepsis_high_risk <- births_sepsis * prop_high_risk_sepsis\n  prop_abx <- 0.2\n  births_abx <- births_per_year * prop_abx\n  births_abx_sepsis_high_risk <- births_sepsis_high_risk\n  births_abx_sepsis_low_risk <- births_abx - births_abx_sepsis_high_risk\n  \n  total_births_per_year <- 130 * 10^6\n  total_births_abx_per_year <- total_births_per_year * prop_abx\n  \n  # If no AMR burden per prescription provided then calculate one\n  if(is.null(amr_burden_per_abx)) {\n    total_sepsis_burden <- 24.6 * 10^6\n    prop_burden_abx <- 0.31\n    total_amr_burden <- total_sepsis_burden * prop_burden_abx\n    amr_burden_per_abx <- total_amr_burden / total_births_abx_per_year\n  }\n  \n  cost_culture <- 50\n  total_cost_rdt <- 20\n  subsidy_rdt <- 10\n  cost_rdt <- total_cost_rdt - subsidy_rdt\n  cost_treatment <- 5\n  \n  # Scenario 1\n  benefit_correct_sepsis_diagnosis <- 9\n  benefit_s1 <- benefit_correct_sepsis_diagnosis * births_sepsis_low_risk - amr_burden_per_abx * (births_abx_sepsis_low_risk - births_sepsis_low_risk)\n  cost_s1 <- (cost_culture + cost_treatment) * births_abx_sepsis_low_risk\n  cost_per_daly_s1 <- cost_s1 / benefit_s1\n  \n  # Scenario 2\n  sepsis_prev_low_risk <- births_sepsis_low_risk / births_abx_sepsis_low_risk\n  true_positive <- births_abx_sepsis_low_risk * sepsis_prev_low_risk * sensitivity\n  false_negative <- births_abx_sepsis_low_risk * sepsis_prev_low_risk * (1 - sensitivity)\n  true_negative <- births_abx_sepsis_low_risk * (1 - sepsis_prev_low_risk) * specificity\n  false_positive <- births_abx_sepsis_low_risk * (1 - sepsis_prev_low_risk) * (1 - specificity)\n  stopifnot(true_positive + false_positive + false_negative + true_negative == births_abx_sepsis_low_risk)\n  harm_false_negative <- benefit_correct_sepsis_diagnosis * 0.5\n  \n  benefit_s2 <- (true_positive * benefit_correct_sepsis_diagnosis) + \n    (true_negative * amr_burden_per_abx) - \n    (false_negative * harm_false_negative) - \n    (false_positive * amr_burden_per_abx)\n  \n  cost_s2 <- (cost_culture + total_cost_rdt) * births_abx_sepsis_low_risk + (true_positive + false_positive) * cost_treatment\n  cost_per_daly_s2 <- cost_s2 / benefit_s2\n  \n  subsidy_test <- subsidy_rdt * births_abx_sepsis_low_risk\n  cost_incremental <- cost_s2 - subsidy_test - cost_s1\n  benefit_incremental <- benefit_s2 - benefit_s1\n  icer <- cost_incremental / benefit_incremental\n  return(list(icer = icer, cost_incremental = cost_incremental, benefit_incremental = benefit_incremental))\n}\n\nui <- fluidPage(\n  titlePanel(\"Cost effectiveness analysis for an AMR point-of-care test\"),\n  sidebarLayout(\n    sidebarPanel(\n      numericInput(inputId = \"sensitivity\",\n                   label = \"Sensitivity:\",\n                   value = 0.9,\n                   min = 0,\n                   max = 1,\n                   step = 0.01),\n      numericInput(inputId = \"specificity\",\n                   label = \"Specificity:\",\n                   value = 0.95,\n                   min = 0,\n                   max = 1,\n                   step = 0.01),\n      numericInput(inputId = \"amr_burden_per_abx\",\n                   label = \"AMR burden per antibiotic:\",\n                   value = 0.3,\n                   min = 0,\n                   step = 0.01)\n    ),\n    mainPanel(\n        p(\"As compared with treating all low-risk neonates with antibiotics, use of an AMR point of care test, with parameters as specified on the input panel, would result in:\"),\n        p(htmlOutput(outputId = \"ceaOutput\")),\n        p(\"For more details about the model, see\", tags$a(href = \"https://athowes.github.io/amr-poct/model\", \"athowes.github.io/amr-poct/model.\")),\n        p(\"This analysis is a project of \", tags$a(href = \"https://www.amrfundingcircle.com/\", \"AMR Funding Circle.\"))\n    )\n  )\n)\n\nserver <- function(input, output) {\n  output$ceaOutput <- renderText({\n    out <- run_cea(input$sensitivity, input$specificity, input$amr_burden_per_abx)\n    text <- paste0(\n      \"<b>Incremental cost<\/b>: $\", round(out$cost_incremental), \"<br>\",\n      \"<b>Incremental benefit<\/b>: \", round(out$benefit_incremental), \" DALYs <br>\",\n      \"<b>Incremental cost effectiveness ratio<\/b>: \", round(out$icer, 2), \"<br>\",\n      \"<b>DALYs per dollar<\/b>: \", round(1 / out$icer, 4), \"<br>\"\n    )\n    return(text)\n  })\n}\n\nshinyApp(ui = ui, server = server)\n","type":"text"},{"name":"DESCRIPTION","content":"Title: Hello Shiny!\nAuthor: RStudio, Inc.\nAuthorUrl: http://www.rstudio.com/\nLicense: MIT\nDisplayMode: Showcase\nTags: getting-started\nType: Shiny\n","type":"text"}]
